generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                   String                @id
  name                 String
  email                String                @unique
  emailVerified        Boolean               @default(false)
  image                String?
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @default(now()) @updatedAt
  isSuspended          Boolean               @default(false)
  resume_credits       Int                   @default(3)
  role                 String                @default("user")
  interview_minutes    Int                   @default(0)
  planExpiresAt        DateTime?
  plan                 Plan                  @default(FREE)
  polarCustomerId      String?
  polarSubscriptionId  String?
  preferredProvider    String?               @default("AUTO")
  experienceLevel      String?
  goal                 String?
  jobTitle             String?
  jobType              String?
  location             String?
  onboardingCompleted  Boolean               @default(false)
  referralSource       String?
  remotePreference     String?
  selectedTopics       String[]              @default([])
  companyName          String?
  accounts             Account[]
  announcement_read    announcement_read[]
  interview            interview[]
  recruiterApplication RecruiterApplication?
  recruiterJobs        RecruiterJob[]
  resumes              Resume[]
  sessions             Session[]
  supportTickets       SupportTicket[]
  tailoredResumes      TailoredResume[]
  transactions         Transaction[]
  pushSubscriptions    PushSubscription[]

  @@map("user")
}

model Transaction {
  id              String              @id @default(cuid())
  reference       String              @unique
  userId          String
  amount          Int
  currency        String              @default("NGN")
  status          TransactionStatus   @default(PENDING)
  type            TransactionType
  plan            Plan?
  credits         Int?
  minutes         Int?
  metadata        Json?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  polarCheckoutId String?
  provider        TransactionProvider @default(PAYSTACK)
  user            User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([reference])
  @@map("transaction")
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("account")
}

model Verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now()) @updatedAt

  @@map("verification")
}

model Resume {
  id                String                 @id @default(cuid())
  createdAt         DateTime               @default(now())
  updatedAt         DateTime               @updatedAt
  content           String
  name              String
  isPrimary         Boolean                @default(false)
  extractedData     Json?
  analysisData      Json?
  scoreData         Json?
  userId            String
  embedding         Unsupported("vector")?
  status            ResumeStatus           @default(COMPLETED)
  interviews        interview[]
  user              User                   @relation(fields: [userId], references: [id], onDelete: Cascade)
  resume_experience resume_experience?
  resume_skills     resume_skills?
  tailoredResumes   TailoredResume[]

  @@index([userId])
  @@map("resume")
}

model TailoredResume {
  id                           String                 @id @default(cuid())
  createdAt                    DateTime               @default(now())
  updatedAt                    DateTime               @updatedAt
  content                      String
  role                         String?
  jobDescription               String?
  name                         String
  extractedData                Json?
  analysisData                 Json?
  primaryResumeId              String
  userId                       String
  jobDescriptionEmbedding      Unsupported("vector")?
  scores                       Json?
  jobResponsibilitiesEmbedding Unsupported("vector")?
  jobSkillsEmbedding           Unsupported("vector")?
  status                       ResumeStatus           @default(COMPLETED)
  primaryResume                Resume                 @relation(fields: [primaryResumeId], references: [id], onDelete: Cascade)
  user                         User                   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([primaryResumeId])
  @@index([userId])
  @@map("tailored_resume")
}

model interview {
  id               String          @id @default(cuid())
  user_id          String
  start_time       DateTime        @default(now())
  end_time         DateTime?
  duration_seconds Int             @default(0)
  status           InterviewStatus @default(SCHEDULED)
  role             String?
  description      String?
  conversation_id  String?
  analysisFeedback String?
  analysisScore    Float?
  analyzedAt       DateTime?
  perceptionData   Json?
  transcript       Json?
  resume_id        String?
  resume           Resume?         @relation(fields: [resume_id], references: [id])
  user             User            @relation(fields: [user_id], references: [id])

  @@index([user_id, status])
  @@index([conversation_id])
}

model RateLimiterFlexible {
  key    String    @id
  points Int
  expire DateTime?

  @@map("rate_limiter_flexible")
}

model job_categories {
  id              String    @id @default(cuid())
  category        String
  location        String?
  metadata        Json?
  last_fetched_at DateTime?
  active          Boolean   @default(true)
  created_at      DateTime  @default(now())
}

model job_ingest_runs {
  id           String    @id @default(cuid())
  category_id  String?
  created_at   DateTime  @default(now())
  scheduled_at DateTime?
  status       String    @default("scheduled")
  started_at   DateTime?
  finished_at  DateTime?
  attempts     Int       @default(0)
  notes        String?
}

model job_responsibilities {
  id          String                 @id @default(cuid())
  job_id      String?                @unique
  bullet_text String[]
  embedding   Unsupported("vector")?
  jobs        jobs?                  @relation(fields: [job_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model job_skills {
  id          String                 @id @default(cuid())
  job_id      String?                @unique
  skill_text  String[]
  embedding   Unsupported("vector")?
  is_required Boolean?               @default(true)
  jobs        jobs?                  @relation(fields: [job_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model jobs {
  id                   String                 @id @default(cuid())
  job_publisher        String?
  job_title            String?
  employer_name        String?
  employer_logo        String?
  job_apply_link       String?
  job_location         String?
  job_description      String?
  job_posted_at        String?
  job_is_remote        Boolean?
  qualifications       String[]
  responsibilities     String[]
  created_at           DateTime?              @default(now()) @db.Timestamptz(6)
  updated_at           DateTime?              @default(now()) @db.Timestamptz(6)
  embedding            Unsupported("vector")?
  jobCertifications    String[]
  category             String?
  job_responsibilities job_responsibilities?
  job_skills           job_skills?
  recruiterJob         RecruiterJob?
}

model resume_experience {
  id          String                 @id @default(cuid())
  resume_id   String?                @unique
  bullet_text String
  embedding   Unsupported("vector")?
  resume      Resume?                @relation(fields: [resume_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model resume_skills {
  id         String                 @id @default(cuid())
  resume_id  String?                @unique
  skill_text String
  embedding  Unsupported("vector")?
  resume     Resume?                @relation(fields: [resume_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model SupportTicket {
  id        String          @id @default(cuid())
  userId    String
  subject   String
  status    String          @default("open")
  priority  String          @default("medium")
  category  String          @default("general")
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
  user      User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  messages  TicketMessage[]

  @@index([userId])
  @@map("support_ticket")
}

model TicketMessage {
  id        String        @id @default(cuid())
  ticketId  String
  sender    String
  message   String
  createdAt DateTime      @default(now())
  ticket    SupportTicket @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  @@index([ticketId])
  @@map("ticket_message")
}

model Announcement {
  id                String              @id @default(cuid())
  title             String
  content           String
  type              String              @default("in-app")
  sentAt            DateTime            @default(now())
  createdBy         String?
  targetRoles       String[]            @default([])
  targetUserIds     String[]            @default([])
  announcement_read announcement_read[]

  @@map("announcement")
}

model announcement_read {
  id             String       @id @default(cuid())
  userId         String
  announcementId String
  readAt         DateTime     @default(now())
  isDeleted      Boolean      @default(false)
  announcement   Announcement @relation(fields: [announcementId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, announcementId])
  @@index([userId])
}

model RecruiterApplication {
  id                    String            @id @default(cuid())
  userId                String            @unique
  companyName           String
  companyWebsite        String?
  companyLogo           String?
  position              String
  phoneNumber           String
  email                 String
  linkedInProfile       String?
  message               String
  status                ApplicationStatus @default(PENDING)
  reviewedBy            String?
  reviewedAt            DateTime?
  rejectionReason       String?
  createdAt             DateTime          @default(now())
  updatedAt             DateTime          @updatedAt
  verificationDocuments String?
  user                  User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([userId])
  @@map("recruiter_application")
}

model RecruiterJob {
  id                String              @id @default(cuid())
  recruiterId       String
  jobId             String              @unique
  status            RecruiterJobStatus  @default(ACTIVE)
  postedAt          DateTime            @default(now())
  closedAt          DateTime?
  viewCount         Int                 @default(0)
  applicationCount  Int                 @default(0)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  jobCertifications String[]
  candidates        CandidatePipeline[]
  jobViews          JobView[]
  job               jobs                @relation(fields: [jobId], references: [id], onDelete: Cascade)
  recruiter         User                @relation(fields: [recruiterId], references: [id], onDelete: Cascade)

  @@index([recruiterId])
  @@index([status])
  @@map("recruiter_job")
}

model CandidatePipeline {
  id             String          @id @default(cuid())
  recruiterJobId String
  candidateName  String
  candidateEmail String
  status         CandidateStatus @default(NEW)
  notes          String?
  appliedAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  recruiterJob   RecruiterJob    @relation(fields: [recruiterJobId], references: [id], onDelete: Cascade)

  @@index([recruiterJobId])
  @@index([status])
  @@map("candidate_pipeline")
}

model JobView {
  id             String       @id @default(cuid())
  recruiterJobId String
  userId         String?
  viewedAt       DateTime     @default(now())
  ipAddress      String?
  userAgent      String?
  recruiterJob   RecruiterJob @relation(fields: [recruiterJobId], references: [id], onDelete: Cascade)

  @@index([recruiterJobId])
  @@index([viewedAt])
  @@map("job_view")
}

model blog_post {
  id              String       @id @default(cuid())
  slug            String       @unique
  title           String
  content         String
  excerpt         String?
  coverImage      String?
  imagePosition   String       @default("TOP")
  published       Boolean      @default(false)
  authorName      String       @default("Admin")
  readTime        String?
  category        BlogCategory @default(GENERAL)
  metaTitle       String?
  metaDescription String?
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
}

enum Plan {
  FREE
  SILVER
  GOLD
  DIAMOND
}

enum TransactionType {
  SUBSCRIPTION
  CREDIT_PURCHASE
  MINUTE_PURCHASE
}

enum TransactionStatus {
  PENDING
  SUCCESS
  FAILED
}

enum InterviewStatus {
  SCHEDULED
  ACTIVE
  ENDED
  TIMEOUT
  ANALYZED
}

enum ApplicationStatus {
  PENDING
  APPROVED
  REJECTED
}

enum RecruiterJobStatus {
  ACTIVE
  PAUSED
  CLOSED
}

enum CandidateStatus {
  NEW
  REVIEWING
  SHORTLISTED
  INTERVIEWED
  OFFERED
  REJECTED
  HIRED
}

enum ResumeStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

enum TransactionProvider {
  PAYSTACK
  POLAR
}

enum BlogCategory {
  GENERAL
  DEVELOPERS
  JOB_HUNT
  CHANGELOGS
}

model PushSubscription {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  endpoint  String   @unique
  keys      Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@map("push_subscription")
}
