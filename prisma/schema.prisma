generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                String           @id
  name              String
  email             String           @unique
  emailVerified     Boolean          @default(false)
  image             String?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @default(now()) @updatedAt
  remaining_minutes Int              @default(30)
  subscription_id   String?
  accounts          Account[]
  interview         interview[]
  resumes           Resume[]
  sessions          Session[]
  tailoredResumes   TailoredResume[]
  subscription      subscription?    @relation(fields: [subscription_id], references: [id])

  @@map("user")
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  @@map("account")
}

model Verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now()) @updatedAt

  @@map("verification")
}

model Resume {
  id                String             @id @default(cuid())
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  content           String
  name              String
  isPrimary         Boolean            @default(false)
  extractedData     Json?
  analysisData      Json?
  scoreData         Json?
  userId            String
  user              User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  resume_experience resume_experience?
  resume_skills     resume_skills?
  tailoredResumes   TailoredResume[]

  @@index([userId])
  @@map("resume")
}

model TailoredResume {
  id              String   @id @default(cuid())
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  content         String
  role            String?
  jobDescription  String?
  name            String
  extractedData   Json?
  analysisData    Json?
  scoreData       Json?
  primaryResumeId String
  userId          String
  primaryResume   Resume   @relation(fields: [primaryResumeId], references: [id], onDelete: Cascade)
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([primaryResumeId])
  @@index([userId])
  @@map("tailored_resume")
}

model interview {
  id               String          @id @default(cuid())
  user_id          String
  start_time       DateTime        @default(now())
  end_time         DateTime?
  duration_seconds Int             @default(0)
  status           InterviewStatus @default(SCHEDULED)
  role             String?
  description      String?
  conversation_id  String?
  user             User            @relation(fields: [user_id], references: [id])

  @@index([user_id, status])
  @@index([conversation_id])
}

model subscription {
  id            String   @id @default(cuid())
  name          String
  total_minutes Int
  price         Float?
  created_at    DateTime @default(now())
  user          User[]
}

model job_categories {
  id              String    @id @default(cuid())
  category        String
  location        String?
  metadata        Json?
  last_fetched_at DateTime?
  active          Boolean   @default(true)
  created_at      DateTime  @default(now())
}

model job_ingest_runs {
  id           String    @id @default(cuid())
  category_id  String?
  created_at   DateTime  @default(now())
  scheduled_at DateTime?
  status       String    @default("scheduled")
  started_at   DateTime?
  finished_at  DateTime?
  attempts     Int       @default(0)
  notes        String?
}

model job_responsibilities {
  id          String                 @id @default(cuid())
  job_id      String?                @unique
  bullet_text String[]
  embedding   Unsupported("vector")?
  jobs        jobs?                  @relation(fields: [job_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([embedding], map: "idx_job_bullets_vector")
}

model job_skills {
  id          String                 @id @default(cuid())
  job_id      String?                @unique
  skill_text  String[]
  embedding   Unsupported("vector")?
  is_required Boolean?               @default(true)
  jobs        jobs?                  @relation(fields: [job_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([embedding], map: "idx_job_skills_vector")
}

model jobs {
  id                   String                @id @default(cuid())
  job_publisher        String?
  job_title            String?
  employer_name        String?
  employer_logo        String?
  job_apply_link       String?
  job_location         String?
  job_description      String?
  job_posted_at        String?
  job_is_remote        Boolean?
  qualifications       String[]
  responsibilities     String[]
  created_at           DateTime?             @default(now()) @db.Timestamptz(6)
  updated_at           DateTime?             @default(now()) @db.Timestamptz(6)
  job_responsibilities job_responsibilities?
  job_skills           job_skills?
}

model resume_experience {
  id          String                 @id @default(cuid())
  resume_id   String?                @unique
  bullet_text String
  embedding   Unsupported("vector")?
  resume      Resume?                @relation(fields: [resume_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([embedding], map: "idx_resume_bullets_vector")
}

model resume_skills {
  id         String                 @id @default(cuid())
  resume_id  String?                @unique
  skill_text String
  embedding  Unsupported("vector")?
  resume     Resume?                @relation(fields: [resume_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([embedding], map: "idx_resume_skills_vector")
}

enum InterviewStatus {
  SCHEDULED
  ACTIVE
  ENDED
  TIMEOUT
}
